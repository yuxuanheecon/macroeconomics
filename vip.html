<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VIP Nexus v3.1 | Earth Macro</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=JetBrains+Mono:wght@300;500;700&display=swap" rel="stylesheet">
  <!-- å¼•å…¥ Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  
  <style>
    /* ====== å…¨å±€å˜é‡ ====== */
    :root {
      --bg-deep: #050505;
      --gold-primary: #d4af37;
      --gold-dim: #8a7035;
      --gold-bright: #ffd700;
      --neon-red: #ff0055;
      --text-main: #e0e0e0;
      --glass-panel: rgba(20, 20, 20, 0.85);
      --glass-border: rgba(212, 175, 55, 0.3);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: var(--bg-deep);
      color: var(--text-main);
      font-family: 'JetBrains Mono', monospace;
      overflow-x: hidden; min-height: 100vh;
    }

    /* èƒŒæ™¯ Canvas */
    #bg-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; pointer-events: none;
    }

    /* UI å®¹å™¨ */
    #ui-container { opacity: 1; transition: opacity 0.5s ease; }
    body.clock-mode #ui-container { opacity: 0; pointer-events: none; }

    /* é¡¶éƒ¨å¯¼èˆª */
    header {
      padding: 30px 50px; display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
      background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
      position: relative; z-index: 10;
    }
    .vip-logo {
      font-family: 'Cinzel', serif; font-size: 1.8rem; color: var(--gold-primary);
      letter-spacing: 4px; text-transform: uppercase;
      text-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    }
    .back-link {
      color: var(--gold-dim); text-decoration: none; font-size: 0.8rem;
      border: 1px solid var(--gold-dim); padding: 8px 20px; border-radius: 50px; transition: all 0.3s;
      cursor: pointer; position: relative; z-index: 20;
    }
    .back-link:hover { color: var(--bg-deep); background: var(--gold-primary); border-color: var(--gold-primary); box-shadow: 0 0 15px var(--gold-primary); }

    /* ä¸»å†…å®¹åŒº */
    main { max-width: 1200px; margin: 0 auto; padding: 40px 20px 140px; }
    h2 {
      font-family: 'Cinzel', serif; color: var(--text-main); font-size: 1.5rem;
      margin-bottom: 30px; display: flex; align-items: center; gap: 15px;
    }
    h2::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--gold-dim), transparent); }

    /* Grid Styles */
    .grid-vault, .encrypted-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 60px;
    }
    .vault-card {
      background: rgba(20, 20, 20, 0.4); border: 1px solid var(--glass-border);
      padding: 25px; border-radius: 4px; transition: all 0.4s; cursor: pointer;
    }
    .vault-card:hover { transform: translateY(-5px); border-color: var(--gold-primary); background: rgba(212, 175, 55, 0.05); }
    .vault-icon { font-size: 1.5rem; margin-bottom: 15px; color: var(--gold-primary); }
    .vault-title { font-size: 1rem; font-weight: bold; margin-bottom: 10px; color: #fff; }
    .vault-desc { font-size: 0.8rem; color: #888; line-height: 1.6; }
    
    /* åŠ å¯†/å¾…å¼€å‘å¡ç‰‡ */
    .locked-card {
      background: rgba(0, 0, 0, 0.2); border: 1px dashed #333; padding: 30px;
      text-align: center; border-radius: 8px; color: #444; transition: all 0.3s;
      position: relative; overflow: hidden;
    }
    .locked-card:hover { border-color: var(--gold-dim); color: var(--gold-dim); }
    .lock-icon { font-size: 1.5rem; margin-bottom: 10px; opacity: 0.5; }
    
    /* å¯ç‚¹å‡»çš„ç‰¹æ®Šå¡ç‰‡ (å¦‚è±¡æ£‹) */
    .locked-card.unlocked {
      border-style: solid; border-color: var(--neon-red); color: var(--neon-red); cursor: pointer;
      background: rgba(255, 0, 85, 0.05);
    }
    .locked-card.unlocked:hover {
      background: rgba(255, 0, 85, 0.1); box-shadow: 0 0 20px rgba(255, 0, 85, 0.2); transform: translateY(-3px);
    }
    .locked-card.unlocked .lock-icon { opacity: 1; color: var(--neon-red); }

    /* Insight Stream */
    .insight-ticker {
      width: 100%; overflow: hidden; background: rgba(255,255,255,0.03);
      border-top: 1px solid #333; border-bottom: 1px solid #333;
      padding: 10px 0; margin-bottom: 60px; white-space: nowrap; position: relative;
    }
    .ticker-content {
      display: inline-block; animation: marquee 30s linear infinite;
      color: var(--gold-dim); font-size: 0.9rem; letter-spacing: 1px;
    }
    .ticker-item { margin-right: 50px; }
    @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    
    /* ====== æ‚¬æµ®å·¥å…·æ  (Dock) ====== */
    .dock-container {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: rgba(15, 15, 15, 0.8); backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px;
      padding: 12px 24px; display: flex; gap: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.8); z-index: 100; transition: inherit;
    }
    .dock-item {
      width: 50px; height: 50px; border-radius: 14px; background: #222;
      display: flex; justify-content: center; align-items: center;
      font-size: 1.4rem; color: var(--gold-dim); cursor: pointer; transition: all 0.3s;
      position: relative; border: 1px solid transparent;
    }
    .dock-item:hover {
      transform: translateY(-15px) scale(1.15); background: linear-gradient(135deg, #222, #333);
      color: var(--gold-primary); border-color: var(--gold-dim);
    }
    .dock-tooltip {
      position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
      background: #000; color: var(--gold-primary); font-size: 0.7rem;
      padding: 4px 10px; border-radius: 4px; opacity: 0; pointer-events: none;
      white-space: nowrap; transition: opacity 0.2s; border: 1px solid var(--gold-dim);
    }
    .dock-item:hover .dock-tooltip { opacity: 1; top: -50px; }

    /* ====== å…¨å±æ—¶é’Ÿ ====== */
    #full-clock {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      z-index: 50; pointer-events: none; opacity: 0; transition: opacity 0.8s ease;
      background: radial-gradient(circle at center, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.9) 100%);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    }
    body.clock-mode #full-clock { opacity: 1; pointer-events: auto; }

    .clock-time {
      font-size: 12vw; font-weight: 700; color: var(--gold-bright);
      text-shadow: 0 0 30px rgba(212, 175, 55, 0.5), 0 0 60px rgba(212, 175, 55, 0.2);
      letter-spacing: -5px; line-height: 1; position: relative;
    }
    .clock-time::after {
      content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
      background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 2px, transparent 2px, transparent 4px);
      pointer-events: none;
    }
    .clock-date { font-size: 2vw; color: var(--gold-dim); letter-spacing: 5px; margin-top: 20px; text-transform: uppercase; }
    .clock-hint { position: absolute; bottom: 30px; font-size: 0.8rem; color: #444; }

    /* ====== å·¥å…·æ¨¡æ€æ¡† ====== */
    #modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: 150; display: none; backdrop-filter: blur(5px);
    }
    .tool-modal {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
      width: 450px; max-width: 95%; background: rgba(12, 12, 14, 0.95);
      border: 1px solid var(--gold-dim); border-radius: 12px; padding: 25px;
      z-index: 200; display: none; opacity: 0; transition: all 0.3s ease;
      box-shadow: 0 0 60px rgba(0,0,0,0.9);
    }
    .tool-modal.open { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
    .tool-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;
    }
    .tool-title { font-family: 'Cinzel'; color: var(--gold-primary); font-size: 1.2rem; }
    .tool-close { cursor: pointer; color: #666; font-size: 1.2rem; transition: 0.2s; }
    .tool-close:hover { color: #fff; }

    /* é€šç”¨ç»„ä»¶ */
    .input-group { margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
    .input-label { width: 60px; font-size: 0.8rem; color: #888; }
    .vip-input {
      flex: 1; background: #111; border: 1px solid #333; color: var(--gold-primary);
      padding: 8px; border-radius: 4px; font-family: 'JetBrains Mono'; outline: none; text-align: center;
    }
    .vip-input:focus { border-color: var(--gold-dim); }
    .vip-btn {
      width: 100%; background: var(--gold-dim); color: #000; border: none;
      padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer;
      margin-top: 10px; transition: 0.2s; font-family: 'JetBrains Mono';
    }
    .vip-btn:hover { background: var(--gold-primary); }
    .vip-btn.outline { background: transparent; border: 1px solid var(--gold-dim); color: var(--gold-dim); }
    .vip-btn.outline:hover { background: rgba(212, 175, 55, 0.1); }

    /* RNG */
    .rng-result {
      background: #000; border: 1px solid #333; padding: 15px; margin-top: 15px;
      min-height: 60px; border-radius: 4px; color: var(--gold-bright);
      font-size: 1.2rem; text-align: center; word-break: break-all; display: flex; align-items: center; justify-content: center;
    }
    .history-box {
      margin-top: 15px; height: 100px; overflow-y: auto;
      font-size: 0.7rem; color: #666; border-top: 1px solid #222; padding-top: 5px;
    }
    .history-item { margin-bottom: 3px; border-bottom: 1px dashed #222; padding-bottom: 2px; display: flex; justify-content: space-between; }

    /* Toys (3D Scene) */
    #toys-canvas-container {
      width: 100%; height: 250px; background: #000; border: 1px solid #333;
      border-radius: 4px; margin: 15px 0; overflow: hidden; position: relative;
    }
    .toys-controls { display: flex; gap: 10px; align-items: center; }
    .toys-controls .input-group { margin-bottom: 0; width: 80px; }
    
    /* Timer */
    .timer-display {
      font-size: 4rem; font-weight: bold; text-align: center; color: var(--gold-primary);
      margin: 20px 0; text-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
    }
    .timer-custom { display: flex; justify-content: center; gap: 5px; margin-bottom: 20px; }
    .timer-custom input { width: 60px; text-align: center; font-size: 1.2rem; padding: 5px; }

    /* World Clock */
    .world-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .clock-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; text-align: center; border: 1px solid #333; }
    .city-name { color: #888; font-size: 0.7rem; letter-spacing: 1px; margin-bottom: 5px; }
    .city-time { font-size: 1.2rem; color: #fff; font-weight: bold; }
    .market-status { font-size: 0.6rem; margin-top: 3px; font-weight: bold; }
    .status-open { color: var(--neon-green); } .status-close { color: var(--neon-red); }

    /* Calc */
    .calc-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.8rem; }
    .calc-res-big { font-size: 1.5rem; color: var(--gold-bright); text-align: center; margin: 15px 0; font-weight: bold; }

    /* ç¦»åœºé»‘å± */
    .exit-layer {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9998; opacity: 0; pointer-events: none;
      transition: opacity 1s ease; display: flex; justify-content: center; align-items: center;
      color: #444; font-family: 'JetBrains Mono'; letter-spacing: 3px;
    }
    .exit-layer.active { opacity: 1; pointer-events: auto; }

  </style>
</head>
<body>

  <!-- ç¦»åœºåŠ¨ç”»å±‚ -->
  <div class="exit-layer" id="outro-layer">TERMINATING SESSION...</div>

  <!-- å…¨å±€èƒŒæ™¯ Three.js Canvas -->
  <canvas id="bg-canvas"></canvas>

  <!-- å…¨å±æ—¶é’Ÿå±‚ -->
  <div id="full-clock" onclick="toggleClockMode()">
    <div class="clock-time" id="clock-time-display">00:00:00</div>
    <div class="clock-date" id="clock-date-display">MONDAY, JAN 01</div>
    <div class="clock-hint">CLICK ANYWHERE TO EXIT</div>
  </div>

  <!-- ä¸»ç•Œé¢ UI å®¹å™¨ (ç›´æ¥æ˜¾ç¤º) -->
  <div id="ui-container">
    <header>
      <div class="vip-logo">VIP NEXUS v3.1</div>
      <a onclick="exitVip()" class="back-link">EXIT SECURE SPACE</a>
    </header>

    <main>
      <section>
        <h2><span style="color:var(--gold-primary)">01.</span> KNOWLEDGE VAULT</h2>
        <div class="grid-vault">
          <div class="vault-card" style="border-color: var(--gold-bright); background: rgba(255, 215, 0, 0.05);" onclick="window.open('ä¹ è¿‘å¹³å’Œä»–çš„æƒ…äººä»¬ï¼ˆé‡ç½®ç‰ˆï¼‰.pdf', '_blank')">
            <div class="vault-icon">ğŸ”¥</div>
            <div class="vault-title">ä¹ è¿‘å¹³å’Œä»–çš„æƒ…äººä»¬ï¼ˆé‡ç½®ç‰ˆï¼‰</div>
            <div class="vault-desc">ã€VIP ä¸“äº«ã€‘æ·±åº¦æ”¿æ²»å®è§‚å™äº‹ï¼Œè§£ææƒåŠ›æ¶æ„ä¸éšç§˜å†å²ã€‚</div>
          </div>

          <div class="vault-card" onclick="window.open('FupengspeechHSBC.pdf', '_blank')">
            <div class="vault-icon">ğŸ“œ</div>
            <div class="vault-title">2025 å®è§‚ç»ˆå±€æ¨æ¼”</div>
            <div class="vault-desc">ä»˜é¹ HSBC å†…éƒ¨æ¼”è®²å®å½•ã€‚æ·±åº¦å¤ç›˜ã€‚</div>
          </div>
          <div class="vault-card" onclick="window.open('commodityinvestment.pdf', '_blank')">
            <div class="vault-icon">âš–ï¸</div>
            <div class="vault-title">å¤§ç±»èµ„äº§é…ç½®é€»è¾‘</div>
            <div class="vault-desc">ç¾æ—æ—¶é’Ÿçš„å˜ä½“åº”ç”¨ã€‚å¯»æ‰¾ Alpha æ”¶ç›Šã€‚</div>
          </div>
          <div class="vault-card" onclick="window.open('Wedge.pdf', '_blank')">
            <div class="vault-icon">ğŸ§©</div>
            <div class="vault-title">ç»æµä¸­çš„æ‘©æ“¦åŠ›</div>
            <div class="vault-desc">ç†è§£äº¤æ˜“æˆæœ¬ä¸ä¿¡æ¯ä¸å¯¹ç§°ã€‚</div>
          </div>
        </div>
      </section>
      
       <!-- å¾…å¼€å‘ / ç‰¹æ®Šåº”ç”¨ -->
      <section>
        <h2><span style="color:var(--gold-primary)">02.</span> CLASSIFIED & APPS</h2>
        <div class="encrypted-grid">
          <!-- æ–°å¢ï¼šèµ›åšè±¡æ£‹å…¥å£ -->
          <div class="locked-card unlocked" onclick="location.href='cyber_chess.html'">
            <div class="lock-icon">â™Ÿï¸</div>
            <div class="lock-text" style="color:var(--neon-red)">CYBER XIANGQI</div>
            <div style="font-size:0.7rem; color:var(--neon-red); margin-top:5px;">PROJECT: DOUBLE STEP</div>
          </div>

          <div class="locked-card"><div class="lock-icon">ğŸ”’</div><div class="lock-text">QUANT_V1</div></div>
          <div class="locked-card"><div class="lock-icon">ğŸ”’</div><div class="lock-text">DARK_POOL</div></div>
        </div>
      </section>
      
      <!-- æ»šåŠ¨è¯­å½• -->
      <section>
        <div class="insight-ticker">
           <div class="ticker-content">
              <span class="ticker-item">"The stock market is a device for transferring money from the impatient to the patient." - Warren Buffett</span>
              <span class="ticker-item">"Risk comes from not knowing what you're doing."</span>
              <span class="ticker-item">"Cash is trash." - Ray Dalio</span>
              <span class="ticker-item">"Markets can remain irrational longer than you can remain solvent." - Keynes</span>
              <span class="ticker-item">"Be fearful when others are greedy."</span>
           </div>
        </div>
      </section>
    </main>

    <div class="dock-container">
      <div class="dock-item" onclick="openTool('worldclock')">
        ğŸŒ<div class="dock-tooltip">Global Market</div>
      </div>
      <div class="dock-item" onclick="openTool('calc')">
        ğŸ§®<div class="dock-tooltip">Compound Calc</div>
      </div>
      <div class="dock-item" onclick="toggleClockMode()">
        ğŸ•’<div class="dock-tooltip">Full Clock</div>
      </div>
      <div class="dock-item" onclick="openTool('rng')">
        ğŸ²<div class="dock-tooltip">Quantum RNG</div>
      </div>
      <div class="dock-item" onclick="openTool('toys')">
        ğŸª™<div class="dock-tooltip">Fate Caster</div>
      </div>
      <div class="dock-item" onclick="openTool('timer')">
        â³<div class="dock-tooltip">Focus Timer</div>
      </div>
      <div class="dock-item" style="border-left:1px solid #444" onclick="location.href='game.html'">
        ğŸ®<div class="dock-tooltip">Simulation</div>
      </div>
    </div>
  </div>

  <div id="modal-overlay" onclick="closeAllTools()"></div>

  <!-- Tool 1: World Clock -->
  <div id="modal-worldclock" class="tool-modal">
    <div class="tool-header"><div class="tool-title">MARKET WATCH</div><div class="tool-close" onclick="closeAllTools()">Ã—</div></div>
    <div class="world-grid" id="world-grid"></div>
  </div>

  <!-- Tool 2: Calculator -->
  <div id="modal-calc" class="tool-modal">
    <div class="tool-header"><div class="tool-title">QUANT CALCULATOR</div><div class="tool-close" onclick="closeAllTools()">Ã—</div></div>
    <div class="input-group">
      <span class="input-label">Principal</span>
      <input type="number" id="calc-p" class="vip-input" value="10000">
    </div>
    <div class="input-group">
      <span class="input-label">Rate (%)</span>
      <input type="number" id="calc-r" class="vip-input" value="10">
    </div>
    <div class="input-group">
      <span class="input-label">Years</span>
      <input type="number" id="calc-t" class="vip-input" value="10">
    </div>
    <button class="vip-btn" onclick="calcCompound()">CALCULATE RETURN</button>
    <div class="calc-res-big" id="calc-res">$0</div>
  </div>

  <!-- Tool 3: RNG -->
  <div id="modal-rng" class="tool-modal">
    <div class="tool-header"><div class="tool-title">QUANTUM RNG</div><div class="tool-close" onclick="closeAllTools()">Ã—</div></div>
    <div class="input-group">
      <span class="input-label">Range</span>
      <input type="number" id="rng-min" class="vip-input" value="1" placeholder="Min">
      <span style="color:#666">-</span>
      <input type="number" id="rng-max" class="vip-input" value="100" placeholder="Max">
    </div>
    <div class="input-group">
      <span class="input-label">Count</span>
      <input type="number" id="rng-count" class="vip-input" value="5" max="50" min="1">
      <label style="color:#888; font-size:0.8rem; display:flex; align-items:center; gap:5px; margin-left:10px;">
        <input type="checkbox" id="rng-unique" checked> Unique
      </label>
    </div>
    <button class="vip-btn" onclick="generateRNG()">GENERATE DATA</button>
    <div class="rng-result" id="rng-display">READY</div>
    <button class="vip-btn outline" onclick="copyRNG()">COPY OUTPUT</button>
    <div class="history-box" id="rng-history"></div>
  </div>

  <!-- Tool 4: Toys -->
  <div id="modal-toys" class="tool-modal">
    <div class="tool-header"><div class="tool-title">FATE CASTER 3D</div><div class="tool-close" onclick="closeAllTools()">Ã—</div></div>
    <div id="toys-canvas-container"></div>
    <div class="toys-controls" style="margin-bottom:10px;">
        <div class="input-group"><input type="number" id="coin-qty" class="vip-input" value="1" min="1" max="5" title="Qty"></div>
        <button class="vip-btn" style="flex:3; margin-top:0;" onclick="throwObjects('coin')">FLIP COINS</button>
    </div>
    <div class="toys-controls">
        <div class="input-group"><input type="number" id="dice-qty" class="vip-input" value="1" min="1" max="5" title="Qty"></div>
        <button class="vip-btn outline" style="flex:3; margin-top:0;" onclick="throwObjects('dice')">ROLL DICE</button>
    </div>
    <div id="toys-result" style="text-align:center; margin-top:15px; color:var(--gold-primary); min-height:30px; font-size:1.2rem; font-weight:bold; font-family:'Share Tech Mono';"></div>
  </div>

  <!-- Tool 5: Timer -->
  <div id="modal-timer" class="tool-modal">
    <div class="tool-header"><div class="tool-title">FOCUS FIELD</div><div class="tool-close" onclick="closeAllTools()">Ã—</div></div>
    <div class="timer-display" id="timer-val">25:00</div>
    <div class="timer-custom">
      <input type="number" id="timer-input-min" class="vip-input" placeholder="MM" value="25" min="0" max="999">
      <span style="font-size:1.5rem; color:#666">:</span>
      <input type="number" id="timer-input-sec" class="vip-input" placeholder="SS" value="00" min="0" max="59">
      <button class="vip-btn outline" style="width:auto; margin-top:0;" onclick="setCustomTimer()">SET</button>
    </div>
    <div style="display:flex; gap:10px;">
      <button class="vip-btn" onclick="toggleTimer()" id="timer-btn">START</button>
      <button class="vip-btn outline" onclick="resetTimer()">RESET</button>
    </div>
  </div>

  <script>
    /* ====== 0. Init (Simplified, no intro) ====== */
    window.onload = () => {
      animateBg(); updateClock(); updateWorldClocks();
    };
    function exitVip() {
      const outro = document.getElementById('outro-layer');
      outro.classList.add('active');
      setTimeout(() => { window.location.href = 'index.html'; }, 1500);
    }

    /* ====== 1. BG ====== */
    const bgScene = new THREE.Scene();
    const bgCamera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const bgRenderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
    bgRenderer.setSize(window.innerWidth, window.innerHeight);
    bgRenderer.setPixelRatio(window.devicePixelRatio);
    const bgGeo = new THREE.BufferGeometry();
    const bgCount = 800;
    const bgPos = new Float32Array(bgCount * 3);
    for(let i=0; i<bgCount*3; i++) bgPos[i] = (Math.random()-0.5)*20;
    bgGeo.setAttribute('position', new THREE.BufferAttribute(bgPos, 3));
    const bgMat = new THREE.PointsMaterial({ size: 0.04, color: 0xd4af37, transparent: true, opacity: 0.5 });
    const bgParticles = new THREE.Points(bgGeo, bgMat);
    bgScene.add(bgParticles);
    bgCamera.position.z = 5;
    let mouseX=0, mouseY=0;
    document.addEventListener('mousemove', e => { mouseX = e.clientX/window.innerWidth-0.5; mouseY = e.clientY/window.innerHeight-0.5; });
    function animateBg() {
      requestAnimationFrame(animateBg);
      bgParticles.rotation.y += 0.0005;
      bgParticles.rotation.x = mouseY * 0.1; bgParticles.rotation.y += mouseX * 0.1;
      bgRenderer.render(bgScene, bgCamera);
    }
    window.addEventListener('resize', () => {
      bgCamera.aspect = window.innerWidth/window.innerHeight; bgCamera.updateProjectionMatrix();
      bgRenderer.setSize(window.innerWidth, window.innerHeight);
    });

    /* ====== 2. Clocks ====== */
    function toggleClockMode() { document.body.classList.toggle('clock-mode'); }
    function updateClock() {
      const now = new Date();
      document.getElementById('clock-time-display').innerText = now.toLocaleTimeString('en-GB');
      document.getElementById('clock-date-display').innerText = now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: '2-digit' });
    }
    setInterval(updateClock, 1000);

    function updateWorldClocks() {
      const cities = [
        { name: 'NEW YORK', tz: 'America/New_York', open: 9.5, close: 16 },
        { name: 'LONDON', tz: 'Europe/London', open: 8, close: 16.5 },
        { name: 'TOKYO', tz: 'Asia/Tokyo', open: 9, close: 15 },
        { name: 'HONG KONG', tz: 'Asia/Hong_Kong', open: 9.5, close: 16 }
      ];
      const container = document.getElementById('world-grid');
      container.innerHTML = '';
      cities.forEach(c => {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-GB', { timeZone: c.tz, hour: '2-digit', minute: '2-digit' });
        const hour = parseInt(timeString.split(':')[0]) + parseInt(timeString.split(':')[1])/60;
        const day = now.toLocaleDateString('en-US', { timeZone: c.tz, weekday: 'short' });
        const isWeekend = day === 'Sat' || day === 'Sun';
        let status = 'CLOSED'; let statusClass = 'status-close';
        if (!isWeekend && hour >= c.open && hour < c.close) { status = 'OPEN'; statusClass = 'status-open'; }
        container.innerHTML += `<div class="clock-card"><div class="city-name">${c.name}</div><div class="city-time">${timeString}</div><div class="market-status ${statusClass}">${status}</div></div>`;
      });
    }
    setInterval(updateWorldClocks, 60000);

    /* ====== 3. Calc ====== */
    function calcCompound() {
      const p = parseFloat(document.getElementById('calc-p').value);
      const r = parseFloat(document.getElementById('calc-r').value) / 100;
      const t = parseFloat(document.getElementById('calc-t').value);
      const result = p * Math.pow((1 + r), t);
      document.getElementById('calc-res').innerText = '$' + Math.floor(result).toLocaleString();
    }

    /* ====== 4. Tools Modal Logic ====== */
    function openTool(id) {
      closeAllTools();
      document.getElementById('modal-overlay').style.display = 'block';
      document.getElementById('modal-' + id).classList.add('open');
      if(id === 'toys') setTimeout(initToys3D, 100);
      if(id === 'worldclock') updateWorldClocks();
    }
    function closeAllTools() {
      document.getElementById('modal-overlay').style.display = 'none';
      document.querySelectorAll('.tool-modal').forEach(el => el.classList.remove('open'));
      if(toysAnimFrameId) cancelAnimationFrame(toysAnimFrameId);
    }

    /* ====== 5. RNG ====== */
    function generateRNG() {
      const min = parseInt(document.getElementById('rng-min').value)||0;
      const max = parseInt(document.getElementById('rng-max').value)||100;
      let count = parseInt(document.getElementById('rng-count').value)||1;
      const unique = document.getElementById('rng-unique').checked;
      const display = document.getElementById('rng-display');
      const history = document.getElementById('rng-history');
      if(min >= max) { display.innerText = "Error: Min >= Max"; return; }
      if(unique && (max - min + 1) < count) { display.innerText = "Error: Range too small"; return; }
      let result = [];
      if(unique) {
        const set = new Set();
        while(set.size < count) set.add(Math.floor(Math.random() * (max - min + 1)) + min);
        result = Array.from(set);
      } else {
        for(let i=0; i<count; i++) result.push(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      const resStr = result.join(', ');
      display.innerText = resStr;
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `<span>${new Date().toLocaleTimeString()}</span> <span>${resStr}</span>`;
      history.prepend(div);
    }
    function copyRNG() { navigator.clipboard.writeText(document.getElementById('rng-display').innerText).then(() => alert('Copied!')); }

    /* ====== 6. Toys 3D ====== */
    let toysScene, toysCamera, toysRenderer, toysAnimFrameId;
    let toyObjects = [];
    let currentToyResults = null;
    function initToys3D() {
      const container = document.getElementById('toys-canvas-container');
      if(toysRenderer) { clearToys(); animateToys(); return; }
      toysScene = new THREE.Scene();
      toysCamera = new THREE.PerspectiveCamera(50, container.offsetWidth/container.offsetHeight, 0.1, 1000);
      toysRenderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      toysRenderer.setSize(container.offsetWidth, container.offsetHeight);
      container.innerHTML = ''; container.appendChild(toysRenderer.domElement);
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.8); toysScene.add(ambientLight);
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8); dirLight.position.set(5, 10, 7); toysScene.add(dirLight);
      toysCamera.position.set(0, 10, 8); toysCamera.lookAt(0, 0, 0);
      animateToys();
    }
    function clearToys() { toyObjects.forEach(obj => toysScene.remove(obj.mesh)); toyObjects = []; document.getElementById('toys-result').innerText = ""; currentToyResults = null; }
    function createCoinGeometry() {
      const geo = new THREE.CylinderGeometry(1.2, 1.2, 0.15, 32);
      const matSide = new THREE.MeshStandardMaterial({ color: 0xdaa520 });
      const matHead = createCoinMaterial("$"); const matTail = createCoinMaterial("1"); 
      return new THREE.Mesh(geo, [matSide, matHead, matTail]);
    }
    function createCoinMaterial(text) {
      const canvas = document.createElement('canvas'); canvas.width = 128; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      const grad = ctx.createRadialGradient(64,64,10,64,64,64); grad.addColorStop(0, '#ffd700'); grad.addColorStop(1, '#b8860b');
      ctx.fillStyle = grad; ctx.fillRect(0, 0, 128, 128);
      ctx.fillStyle = '#5a4a10'; ctx.font = 'bold 80px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(text, 64, 64);
      ctx.lineWidth = 5; ctx.strokeStyle = '#5a4a10'; ctx.beginPath(); ctx.arc(64,64,55,0,Math.PI*2); ctx.stroke();
      const tex = new THREE.CanvasTexture(canvas); return new THREE.MeshStandardMaterial({ map: tex, metalness: 0.8, roughness: 0.3 });
    }
    function createDiceGeometry() {
        const geo = new THREE.BoxGeometry(1.5, 1.5, 1.5);
        const m1 = createDiceTexture(1, '#d00'); const m2 = createDiceTexture(2, '#00d'); 
        const m3 = createDiceTexture(3, '#0d0'); const m4 = createDiceTexture(4, '#d0d'); 
        const m5 = createDiceTexture(5, '#dd0'); const m6 = createDiceTexture(6, '#0dd'); 
        return new THREE.Mesh(geo, [m3, m4, m1, m6, m2, m5]);
    }
    function createDiceTexture(number, color) {
      const canvas = document.createElement('canvas'); canvas.width = 128; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = color; ctx.fillRect(0, 0, 128, 128);
      ctx.strokeStyle = "#fff"; ctx.lineWidth = 10; ctx.strokeRect(0,0,128,128);
      ctx.fillStyle = 'white'; const dotSize = 14;
      const drawDot = (x, y) => { ctx.beginPath(); ctx.arc(x, y, dotSize, 0, Math.PI*2); ctx.fill(); };
      if(number%2!==0) drawDot(64,64);
      if(number>1) { drawDot(30,30); drawDot(98,98); }
      if(number>3) { drawDot(30,98); drawDot(98,30); }
      if(number===6) { drawDot(30,64); drawDot(98,64); }
      const tex = new THREE.CanvasTexture(canvas); return new THREE.MeshStandardMaterial({ map: tex });
    }
    function throwObjects(type) {
      clearToys(); document.getElementById('toys-result').innerText = "";
      const qty = parseInt(document.getElementById(type + '-qty').value) || 1;
      let results = [];
      for(let i=0; i<qty; i++) {
        let mesh, targetRot, res;
        if(type === 'coin') {
          res = Math.random() > 0.5 ? "HEADS" : "TAILS";
          mesh = createCoinGeometry();
          targetRot = { x: res === "HEADS" ? 0 : Math.PI, z: 0 };
        } else {
          const val = Math.floor(Math.random() * 6) + 1; res = val.toString();
          mesh = createDiceGeometry();
          if(val===1) targetRot = {x:0, z:0}; if(val===6) targetRot = {x:Math.PI, z:0};
          if(val===2) targetRot = {x:-Math.PI/2, z:0}; if(val===5) targetRot = {x:Math.PI/2, z:0};
          if(val===3) targetRot = {x:0, z:Math.PI/2}; if(val===4) targetRot = {x:0, z:-Math.PI/2};
        }
        results.push(res);
        mesh.position.set((Math.random()-0.5)*4, 7 + Math.random()*2, (Math.random()-0.5)*2);
        mesh.rotation.set(Math.random()*Math.PI*2, Math.random()*Math.PI*2, Math.random()*Math.PI*2);
        toysScene.add(mesh);
        toyObjects.push({ mesh: mesh, targetRot: targetRot, vel: new THREE.Vector3((Math.random()-0.5)*0.15, 0, (Math.random()-0.5)*0.15), rotVel: new THREE.Vector3(Math.random()+0.5, Math.random()+0.5, Math.random()+0.5), yVel: 0, yPos: mesh.position.y, settled: false });
      }
      currentToyResults = "RESULT: " + results.join(", ");
    }
    function animateToys() {
      toysAnimFrameId = requestAnimationFrame(animateToys);
      let allSettled = true;
      toyObjects.forEach(obj => {
        if (obj.settled) {
            obj.mesh.rotation.x += (obj.targetRot.x - obj.mesh.rotation.x) * 0.1;
            obj.mesh.rotation.z += (obj.targetRot.z - obj.mesh.rotation.z) * 0.1;
            return;
        }
        allSettled = false;
        obj.yVel -= 0.02; obj.yPos += obj.yVel;
        if(obj.yPos <= 0.7) {
          obj.yPos = 0.7; obj.yVel *= -0.5; obj.rotVel.multiplyScalar(0.8);
          if(Math.abs(obj.yVel) < 0.05) {
             obj.settled = true;
             const snap = (val, target) => { let cycles = Math.round(val / (Math.PI*2)); return target + cycles * Math.PI * 2; };
             obj.targetRot.x = snap(obj.mesh.rotation.x, obj.targetRot.x);
             obj.targetRot.z = snap(obj.mesh.rotation.z, obj.targetRot.z);
          }
        }
        obj.mesh.position.y = obj.yPos; obj.mesh.position.x += obj.vel.x; obj.mesh.position.z += obj.vel.z;
        if(!obj.settled) { obj.mesh.rotation.x += obj.rotVel.x; obj.mesh.rotation.y += obj.rotVel.y; obj.mesh.rotation.z += obj.rotVel.z; }
      });
      if (allSettled && currentToyResults && toyObjects.length > 0) {
          document.getElementById('toys-result').innerText = currentToyResults; currentToyResults = null;
      }
      if(toysRenderer && toysScene && toysCamera) toysRenderer.render(toysScene, toysCamera);
    }

    /* ====== 7. Timer ====== */
    let timerInterval; let timeLeft = 1500; let isRunning = false;
    function formatTime(sec) { return `${Math.floor(sec/60).toString().padStart(2,'0')}:${(sec%60).toString().padStart(2,'0')}`; }
    function updateTimerDisplay() { document.getElementById('timer-val').innerText = formatTime(timeLeft); }
    function setTimer(min) { stopTimer(); timeLeft = min * 60; updateInputs(min, 0); updateTimerDisplay(); }
    function setCustomTimer() { stopTimer(); const m = parseInt(document.getElementById('timer-input-min').value)||0; const s = parseInt(document.getElementById('timer-input-sec').value)||0; timeLeft = m*60+s; updateTimerDisplay(); }
    function updateInputs(m, s) { document.getElementById('timer-input-min').value = m; document.getElementById('timer-input-sec').value = s; }
    function toggleTimer() { if(isRunning) stopTimer(); else startTimer(); }
    function startTimer() { isRunning = true; document.getElementById('timer-btn').innerText = "PAUSE"; timerInterval = setInterval(() => { if(timeLeft > 0) { timeLeft--; updateTimerDisplay(); } else { stopTimer(); alert("Time is up!"); } }, 1000); }
    function stopTimer() { isRunning = false; document.getElementById('timer-btn').innerText = "START"; clearInterval(timerInterval); }
    function resetTimer() { stopTimer(); timeLeft = 1500; updateInputs(25, 0); updateTimerDisplay(); }
  </script>
</body>
</html>
