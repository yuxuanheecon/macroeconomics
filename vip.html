<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VIP Nexus v2.3 | Earth Macro</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=JetBrains+Mono:wght@300;500;700&display=swap" rel="stylesheet">
  <!-- å¼•å…¥ Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  
  <style>
    /* ====== å…¨å±€å˜é‡ ====== */
    :root {
      --bg-deep: #050505;
      --gold-primary: #d4af37;
      --gold-dim: #8a7035;
      --gold-bright: #ffd700;
      --neon-green: #00ff9d;
      --text-main: #e0e0e0;
      --glass-panel: rgba(20, 20, 20, 0.85);
      --glass-border: rgba(212, 175, 55, 0.3);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: var(--bg-deep);
      color: var(--text-main);
      font-family: 'JetBrains Mono', monospace;
      overflow-x: hidden; min-height: 100vh;
    }

    /* èƒŒæ™¯ Canvas (å…¨å±€) */
    #bg-canvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; pointer-events: none;
    }

    /* UI å®¹å™¨ */
    #ui-container { transition: opacity 0.5s ease; }
    body.clock-mode #ui-container { opacity: 0; pointer-events: none; }

    /* é¡¶éƒ¨å¯¼èˆª */
    header {
      padding: 30px 50px; display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid rgba(212, 175, 55, 0.1);
      background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
      position: relative; z-index: 10;
    }
    .vip-logo {
      font-family: 'Cinzel', serif; font-size: 1.8rem; color: var(--gold-primary);
      letter-spacing: 4px; text-transform: uppercase;
      text-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    }
    .back-link {
      color: var(--gold-dim); text-decoration: none; font-size: 0.8rem;
      border: 1px solid var(--gold-dim); padding: 8px 20px; border-radius: 50px; transition: all 0.3s;
      cursor: pointer; position: relative; z-index: 20;
    }
    .back-link:hover { color: var(--bg-deep); background: var(--gold-primary); border-color: var(--gold-primary); box-shadow: 0 0 15px var(--gold-primary); }

    /* ä¸»å†…å®¹åŒº */
    main { max-width: 1200px; margin: 0 auto; padding: 40px 20px 140px; }
    h2 {
      font-family: 'Cinzel', serif; color: var(--text-main); font-size: 1.5rem;
      margin-bottom: 30px; display: flex; align-items: center; gap: 15px;
    }
    h2::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--gold-dim), transparent); }

    /* Grid Styles */
    .grid-vault, .encrypted-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 60px;
    }
    .vault-card {
      background: rgba(20, 20, 20, 0.4); border: 1px solid var(--glass-border);
      padding: 25px; border-radius: 4px; transition: all 0.4s; cursor: pointer;
    }
    .vault-card:hover { transform: translateY(-5px); border-color: var(--gold-primary); background: rgba(212, 175, 55, 0.05); }
    .vault-icon { font-size: 1.5rem; margin-bottom: 15px; color: var(--gold-primary); }
    .vault-title { font-size: 1rem; font-weight: bold; margin-bottom: 10px; color: #fff; }
    .vault-desc { font-size: 0.8rem; color: #888; line-height: 1.6; }
    .locked-card {
      background: rgba(0, 0, 0, 0.2); border: 1px dashed #333; padding: 30px;
      text-align: center; border-radius: 8px; color: #444; transition: all 0.3s;
    }
    .locked-card:hover { border-color: var(--gold-dim); color: var(--gold-dim); }
    .lock-icon { font-size: 1.5rem; margin-bottom: 10px; opacity: 0.5; }
    
    /* ====== æ‚¬æµ®å·¥å…·æ  (Dock) ====== */
    .dock-container {
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
      background: rgba(15, 15, 15, 0.8); backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px;
      padding: 12px 24px; display: flex; gap: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.8); z-index: 100; transition: inherit;
    }
    .dock-item {
      width: 50px; height: 50px; border-radius: 14px; background: #222;
      display: flex; justify-content: center; align-items: center;
      font-size: 1.4rem; color: var(--gold-dim); cursor: pointer; transition: all 0.3s;
      position: relative; border: 1px solid transparent;
    }
    .dock-item:hover {
      transform: translateY(-15px) scale(1.15); background: linear-gradient(135deg, #222, #333);
      color: var(--gold-primary); border-color: var(--gold-dim);
    }
    .dock-tooltip {
      position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
      background: #000; color: var(--gold-primary); font-size: 0.7rem;
      padding: 4px 10px; border-radius: 4px; opacity: 0; pointer-events: none;
      white-space: nowrap; transition: opacity 0.2s; border: 1px solid var(--gold-dim);
    }
    .dock-item:hover .dock-tooltip { opacity: 1; top: -50px; }

    /* ====== å…¨å±æ—¶é’Ÿ ====== */
    #full-clock {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      z-index: 50; pointer-events: none; opacity: 0; transition: opacity 0.8s ease;
      background: radial-gradient(circle at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.9) 100%);
    }
    body.clock-mode #full-clock { opacity: 1; pointer-events: auto; }

    .clock-time {
      font-size: 12vw; font-weight: 700; color: var(--gold-bright);
      text-shadow: 0 0 30px rgba(212, 175, 55, 0.5), 0 0 60px rgba(212, 175, 55, 0.2);
      letter-spacing: -5px; line-height: 1; position: relative;
    }
    .clock-time::after {
      content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
      background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 2px, transparent 2px, transparent 4px);
      pointer-events: none;
    }
    .clock-date { font-size: 2vw; color: var(--gold-dim); letter-spacing: 5px; margin-top: 20px; text-transform: uppercase; }
    .clock-hint { position: absolute; bottom: 30px; font-size: 0.8rem; color: #444; }

    /* ====== å·¥å…·æ¨¡æ€æ¡† ====== */
    #modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7); z-index: 150; display: none; backdrop-filter: blur(5px);
    }
    .tool-modal {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
      width: 450px; max-width: 95%; background: rgba(12, 12, 14, 0.95);
      border: 1px solid var(--gold-dim); border-radius: 12px; padding: 25px;
      z-index: 200; display: none; opacity: 0; transition: all 0.3s ease;
      box-shadow: 0 0 60px rgba(0,0,0,0.9);
    }
    .tool-modal.open { display: block; opacity: 1; transform: translate(-50%, -50%) scale(1); }
    .tool-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;
    }
    .tool-title { font-family: 'Cinzel'; color: var(--gold-primary); font-size: 1.2rem; }
    .tool-close { cursor: pointer; color: #666; font-size: 1.2rem; transition: 0.2s; }
    .tool-close:hover { color: #fff; }

    /* é€šç”¨ç»„ä»¶ */
    .input-group { margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
    .input-label { width: 60px; font-size: 0.8rem; color: #888; }
    .vip-input {
      flex: 1; background: #111; border: 1px solid #333; color: var(--gold-primary);
      padding: 8px; border-radius: 4px; font-family: 'JetBrains Mono'; outline: none; text-align: center;
    }
    .vip-input:focus { border-color: var(--gold-dim); }
    .vip-btn {
      width: 100%; background: var(--gold-dim); color: #000; border: none;
      padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer;
      margin-top: 10px; transition: 0.2s; font-family: 'JetBrains Mono';
    }
    .vip-btn:hover { background: var(--gold-primary); }
    .vip-btn.outline { background: transparent; border: 1px solid var(--gold-dim); color: var(--gold-dim); }
    .vip-btn.outline:hover { background: rgba(212, 175, 55, 0.1); }

    /* RNG */
    .rng-result {
      background: #000; border: 1px solid #333; padding: 15px; margin-top: 15px;
      min-height: 60px; border-radius: 4px; color: var(--gold-bright);
      font-size: 1.2rem; text-align: center; word-break: break-all; display: flex; align-items: center; justify-content: center;
    }
    .history-box {
      margin-top: 15px; height: 100px; overflow-y: auto;
      font-size: 0.7rem; color: #666; border-top: 1px solid #222; padding-top: 5px;
    }
    .history-item { margin-bottom: 3px; border-bottom: 1px dashed #222; padding-bottom: 2px; display: flex; justify-content: space-between; }

    /* Toys (3D Scene) */
    #toys-canvas-container {
      width: 100%; height: 250px; background: #000; border: 1px solid #333;
      border-radius: 4px; margin: 15px 0; overflow: hidden; position: relative;
    }
    .toys-controls { display: flex; gap: 10px; align-items: center; }
    .toys-controls .input-group { margin-bottom: 0; width: 80px; }
    
    /* Timer */
    .timer-display {
      font-size: 4rem; font-weight: bold; text-align: center; color: var(--gold-primary);
      margin: 20px 0; text-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
    }
    .timer-custom { display: flex; justify-content: center; gap: 5px; margin-bottom: 20px; }
    .timer-custom input { width: 60px; text-align: center; font-size: 1.2rem; padding: 5px; }

    /* ====== å…¥åœº/å‡ºåœºåŠ¨ç”»å±‚ ====== */
    .reveal-layer {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9999;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      pointer-events: auto;
    }
    .reveal-content { position: relative; width: 300px; height: 300px; display: flex; justify-content: center; align-items: center; }
    .scan-circle {
      position: absolute; width: 100%; height: 100%; border: 2px solid #333; border-radius: 50%;
      border-top-color: var(--gold-primary); animation: spin 2s linear infinite;
    }
    .scan-inner {
      position: absolute; width: 70%; height: 70%; border: 1px solid #333; border-radius: 50%;
      border-bottom-color: var(--gold-primary); animation: spin 1.5s linear infinite reverse;
    }
    .scan-text {
      font-family: 'JetBrains Mono'; color: var(--gold-primary); font-size: 0.9rem; letter-spacing: 2px;
      margin-top: 30px; text-align: center;
    }
    .scan-grid {
      position: absolute; width: 100%; height: 100%; 
      background: linear-gradient(rgba(212, 175, 55, 0.1) 1px, transparent 1px),
                  linear-gradient(90deg, rgba(212, 175, 55, 0.1) 1px, transparent 1px);
      background-size: 20px 20px; opacity: 0.3;
      mask-image: radial-gradient(circle, black 40%, transparent 70%);
      -webkit-mask-image: radial-gradient(circle, black 40%, transparent 70%);
    }
    .access-granted {
      color: var(--neon-green); font-size: 1.5rem; font-weight: bold; letter-spacing: 3px; 
      text-shadow: 0 0 10px var(--neon-green); display: none; animation: blink 0.5s infinite;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

    /* ç¦»åœºé»‘å± */
    .exit-layer {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9998; opacity: 0; pointer-events: none;
      transition: opacity 1s ease; display: flex; justify-content: center; align-items: center;
      color: #444; font-family: 'JetBrains Mono'; letter-spacing: 3px;
    }
    .exit-layer.active { opacity: 1; pointer-events: auto; }

  </style>
</head>
<body>

  <!-- å…¥åœºåŠ¨ç”»å±‚ -->
  <div class="reveal-layer" id="intro-layer">
    <div class="reveal-content">
      <div class="scan-grid"></div>
      <div class="scan-circle"></div>
      <div class="scan-inner"></div>
      <div style="font-size:3rem;">ğŸ’</div>
    </div>
    <div class="scan-text" id="intro-text">INITIALIZING SECURE CONNECTION...</div>
    <div class="access-granted" id="granted-text">ACCESS GRANTED</div>
  </div>

  <!-- ç¦»åœºåŠ¨ç”»å±‚ -->
  <div class="exit-layer" id="outro-layer">TERMINATING SESSION...</div>

  <!-- å…¨å±€èƒŒæ™¯ Three.js Canvas -->
  <canvas id="bg-canvas"></canvas>

  <!-- å…¨å±æ—¶é’Ÿå±‚ -->
  <div id="full-clock" onclick="toggleClockMode()">
    <div class="clock-time" id="clock-time-display">00:00:00</div>
    <div class="clock-date" id="clock-date-display">MONDAY, JAN 01</div>
    <div class="clock-hint">CLICK ANYWHERE TO EXIT</div>
  </div>

  <!-- ä¸»ç•Œé¢ UI å®¹å™¨ -->
  <div id="ui-container" style="opacity:0"> <!-- Initial hidden for intro -->
    <header>
      <div class="vip-logo">VIP NEXUS v2.3</div>
      <a onclick="exitVip()" class="back-link">EXIT SECURE SPACE</a>
    </header>

    <main>
      <section>
        <h2><span style="color:var(--gold-primary)">01.</span> KNOWLEDGE VAULT</h2>
        <div class="grid-vault">
          <!-- é‡ç£…æ–‡ç«  -->
          <div class="vault-card" style="border-color: var(--gold-bright); background: rgba(255, 215, 0, 0.05);" onclick="window.open('ä¹ è¿‘å¹³å’Œä»–çš„æƒ…äººä»¬ï¼ˆé‡ç½®ç‰ˆï¼‰.pdf', '_blank')">
            <div class="vault-icon">ğŸ”¥</div>
            <div class="vault-title">ä¹ è¿‘å¹³å’Œä»–çš„æƒ…äººä»¬ï¼ˆé‡ç½®ç‰ˆï¼‰</div>
            <div class="vault-desc">ã€VIP ä¸“äº«ã€‘æ·±åº¦æ”¿æ²»å®è§‚å™äº‹ï¼Œè§£ææƒåŠ›æ¶æ„ä¸éšç§˜å†å²ã€‚</div>
          </div>

          <div class="vault-card" onclick="window.open('FupengspeechHSBC.pdf', '_blank')">
            <div class="vault-icon">ğŸ“œ</div>
            <div class="vault-title">2025 å®è§‚ç»ˆå±€æ¨æ¼”</div>
            <div class="vault-desc">ä»˜é¹ HSBC å†…éƒ¨æ¼”è®²å®å½•ã€‚æ·±åº¦å¤ç›˜ã€‚</div>
          </div>
          <div class="vault-card" onclick="window.open('commodityinvestment.pdf', '_blank')">
            <div class="vault-icon">âš–ï¸</div>
            <div class="vault-title">å¤§ç±»èµ„äº§é…ç½®é€»è¾‘</div>
            <div class="vault-desc">ç¾æ—æ—¶é’Ÿçš„å˜ä½“åº”ç”¨ã€‚å¯»æ‰¾ Alpha æ”¶ç›Šã€‚</div>
          </div>
          <div class="vault-card" onclick="window.open('Wedge.pdf', '_blank')">
            <div class="vault-icon">ğŸ§©</div>
            <div class="vault-title">ç»æµä¸­çš„æ‘©æ“¦åŠ›</div>
            <div class="vault-desc">ç†è§£äº¤æ˜“æˆæœ¬ä¸ä¿¡æ¯ä¸å¯¹ç§°ã€‚</div>
          </div>
        </div>
      </section>
      
       <!-- å¾…å¼€å‘ -->
      <section>
        <h2><span style="color:var(--gold-primary)">02.</span> CLASSIFIED</h2>
        <div class="encrypted-grid">
          <div class="locked-card"><div class="lock-icon">ğŸ”’</div><div class="lock-text">QUANT_V1</div></div>
          <div class="locked-card"><div class="lock-icon">ğŸ”’</div><div class="lock-text">DARK_POOL</div></div>
          <div class="locked-card"><div class="lock-icon">ğŸ”’</div><div class="lock-text">WAR_ROOM</div></div>
        </div>
      </section>
    </main>

    <div class="dock-container">
      <div class="dock-item" onclick="toggleClockMode()">
        ğŸ•’<div class="dock-tooltip">Full Clock</div>
      </div>
      <div class="dock-item" style="border-left:1px solid #444" onclick="openTool('rng')">
        ğŸ²<div class="dock-tooltip">Quantum RNG</div>
      </div>
      <div class="dock-item" onclick="openTool('toys')">
        ğŸª™<div class="dock-tooltip">Fate Caster 3D</div>
      </div>
      <div class="dock-item" onclick="openTool('timer')">
        â³<div class="dock-tooltip">Focus Timer</div>
      </div>
      <div class="dock-item" style="border-left:1px solid #444" onclick="location.href='game.html'">
        ğŸ®<div class="dock-tooltip">Simulation</div>
      </div>
    </div>
  </div>

  <div id="modal-overlay" onclick="closeAllTools()"></div>

  <!-- Tool 1: RNG -->
  <div id="modal-rng" class="tool-modal">
    <div class="tool-header">
      <div class="tool-title">QUANTUM RNG</div>
      <div class="tool-close" onclick="closeAllTools()">Ã—</div>
    </div>
    <div class="input-group">
      <span class="input-label">Range</span>
      <input type="number" id="rng-min" class="vip-input" value="1" placeholder="Min">
      <span style="color:#666">-</span>
      <input type="number" id="rng-max" class="vip-input" value="100" placeholder="Max">
    </div>
    <div class="input-group">
      <span class="input-label">Count</span>
      <input type="number" id="rng-count" class="vip-input" value="5" max="50" min="1">
      <label style="color:#888; font-size:0.8rem; display:flex; align-items:center; gap:5px; margin-left:10px;">
        <input type="checkbox" id="rng-unique" checked> Unique
      </label>
    </div>
    <button class="vip-btn" onclick="generateRNG()">GENERATE DATA</button>
    <div class="rng-result" id="rng-display">READY</div>
    <button class="vip-btn outline" onclick="copyRNG()">COPY OUTPUT</button>
    <div class="history-box" id="rng-history"></div>
  </div>

  <!-- Tool 2: Toys (3D Version) -->
  <div id="modal-toys" class="tool-modal">
    <div class="tool-header">
      <div class="tool-title">FATE CASTER 3D</div>
      <div class="tool-close" onclick="closeAllTools()">Ã—</div>
    </div>
    <div id="toys-canvas-container"></div>
    <div class="toys-controls" style="margin-bottom:10px;">
        <div class="input-group">
            <input type="number" id="coin-qty" class="vip-input" value="1" min="1" max="5" title="Qty">
        </div>
        <button class="vip-btn" style="flex:3; margin-top:0;" onclick="throwObjects('coin')">FLIP COINS</button>
    </div>
    <div class="toys-controls">
        <div class="input-group">
            <input type="number" id="dice-qty" class="vip-input" value="1" min="1" max="5" title="Qty">
        </div>
        <button class="vip-btn outline" style="flex:3; margin-top:0;" onclick="throwObjects('dice')">ROLL DICE</button>
    </div>
    <div id="toys-result" style="text-align:center; margin-top:15px; color:var(--gold-primary); min-height:30px; font-size:1.2rem; font-weight:bold; font-family:'Share Tech Mono';"></div>
  </div>

  <!-- Tool 3: Timer -->
  <div id="modal-timer" class="tool-modal">
    <div class="tool-header">
      <div class="tool-title">FOCUS FIELD</div>
      <div class="tool-close" onclick="closeAllTools()">Ã—</div>
    </div>
    <div class="timer-display" id="timer-val">25:00</div>
    
    <div class="timer-custom">
      <input type="number" id="timer-input-min" class="vip-input" placeholder="MM" value="25" min="0" max="999">
      <span style="font-size:1.5rem; color:#666">:</span>
      <input type="number" id="timer-input-sec" class="vip-input" placeholder="SS" value="00" min="0" max="59">
      <button class="vip-btn outline" style="width:auto; margin-top:0;" onclick="setCustomTimer()">SET</button>
    </div>
    
    <div style="display:flex; gap:10px;">
      <button class="vip-btn" onclick="toggleTimer()" id="timer-btn">START</button>
      <button class="vip-btn outline" onclick="resetTimer()">RESET</button>
    </div>
  </div>

  <script>
    /* ====== 0. å…¥åœºåŠ¨ç”»é€»è¾‘ ====== */
    window.onload = () => {
      const introLayer = document.getElementById('intro-layer');
      const introText = document.getElementById('intro-text');
      const grantedText = document.getElementById('granted-text');
      const ui = document.getElementById('ui-container');
      
      // Sequence
      setTimeout(() => { introText.innerText = "VERIFYING BIOMETRICS..."; }, 800);
      setTimeout(() => { introText.innerText = "DECRYPTING SECURE CHANNEL..."; }, 1800);
      setTimeout(() => { 
        introText.style.display = 'none';
        grantedText.style.display = 'block';
      }, 2800);
      
      setTimeout(() => {
        introLayer.style.opacity = '0';
        introLayer.style.pointerEvents = 'none'; // Allow clicks through
        ui.style.opacity = '1';
        
        // Init background
        animateBg();
        updateClock();
      }, 3500);
    };

    function exitVip() {
      const outro = document.getElementById('outro-layer');
      outro.classList.add('active');
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1500);
    }

    /* ====== 1. Global BG ====== */
    const bgScene = new THREE.Scene();
    const bgCamera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const bgRenderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), alpha: true });
    bgRenderer.setSize(window.innerWidth, window.innerHeight);
    bgRenderer.setPixelRatio(window.devicePixelRatio);
    const bgGeo = new THREE.BufferGeometry();
    const bgCount = 800;
    const bgPos = new Float32Array(bgCount * 3);
    for(let i=0; i<bgCount*3; i++) bgPos[i] = (Math.random()-0.5)*20;
    bgGeo.setAttribute('position', new THREE.BufferAttribute(bgPos, 3));
    const bgMat = new THREE.PointsMaterial({ size: 0.04, color: 0xd4af37, transparent: true, opacity: 0.5 });
    const bgParticles = new THREE.Points(bgGeo, bgMat);
    bgScene.add(bgParticles);
    bgCamera.position.z = 5;
    let mouseX=0, mouseY=0;
    document.addEventListener('mousemove', e => { mouseX = e.clientX/window.innerWidth-0.5; mouseY = e.clientY/window.innerHeight-0.5; });
    function animateBg() {
      requestAnimationFrame(animateBg);
      bgParticles.rotation.y += 0.0005;
      bgParticles.rotation.x = mouseY * 0.1; bgParticles.rotation.y += mouseX * 0.1;
      bgRenderer.render(bgScene, bgCamera);
    }
    window.addEventListener('resize', () => {
      bgCamera.aspect = window.innerWidth/window.innerHeight; bgCamera.updateProjectionMatrix();
      bgRenderer.setSize(window.innerWidth, window.innerHeight);
    });

    /* ====== 2. Clock ====== */
    function toggleClockMode() { document.body.classList.toggle('clock-mode'); }
    function updateClock() {
      const now = new Date();
      document.getElementById('clock-time-display').innerText = now.toLocaleTimeString('en-GB');
      document.getElementById('clock-date-display').innerText = now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: '2-digit' });
    }
    setInterval(updateClock, 1000);

    /* ====== 3. Tools Modal Logic ====== */
    function openTool(id) {
      closeAllTools();
      document.getElementById('modal-overlay').style.display = 'block';
      document.getElementById('modal-' + id).classList.add('open');
      if(id === 'toys') setTimeout(initToys3D, 100);
    }
    function closeAllTools() {
      document.getElementById('modal-overlay').style.display = 'none';
      document.querySelectorAll('.tool-modal').forEach(el => el.classList.remove('open'));
      if(toysAnimFrameId) cancelAnimationFrame(toysAnimFrameId);
    }

    /* ====== 4. RNG Logic ====== */
    function generateRNG() {
      const min = parseInt(document.getElementById('rng-min').value)||0;
      const max = parseInt(document.getElementById('rng-max').value)||100;
      let count = parseInt(document.getElementById('rng-count').value)||1;
      const unique = document.getElementById('rng-unique').checked;
      const display = document.getElementById('rng-display');
      const history = document.getElementById('rng-history');

      if(min >= max) { display.innerText = "Error: Min >= Max"; return; }
      if(unique && (max - min + 1) < count) { display.innerText = "Error: Range too small"; return; }

      let result = [];
      if(unique) {
        const set = new Set();
        while(set.size < count) set.add(Math.floor(Math.random() * (max - min + 1)) + min);
        result = Array.from(set);
      } else {
        for(let i=0; i<count; i++) result.push(Math.floor(Math.random() * (max - min + 1)) + min);
      }
      const resStr = result.join(', ');
      display.innerText = resStr;
      
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `<span>${new Date().toLocaleTimeString()}</span> <span>${resStr}</span>`;
      history.prepend(div);
    }
    function copyRNG() { navigator.clipboard.writeText(document.getElementById('rng-display').innerText).then(() => alert('Copied!')); }

    /* ====== 5. Toys 3D (Rigged Physics) ====== */
    let toysScene, toysCamera, toysRenderer, toysAnimFrameId;
    let toyObjects = [];

    function initToys3D() {
      const container = document.getElementById('toys-canvas-container');
      if(toysRenderer) { clearToys(); animateToys(); return; }
      
      toysScene = new THREE.Scene();
      toysCamera = new THREE.PerspectiveCamera(50, container.offsetWidth/container.offsetHeight, 0.1, 1000);
      toysRenderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      toysRenderer.setSize(container.offsetWidth, container.offsetHeight);
      container.innerHTML = ''; container.appendChild(toysRenderer.domElement);
      
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
      toysScene.add(ambientLight);
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(5, 10, 7);
      toysScene.add(dirLight);
      
      toysCamera.position.set(0, 10, 8);
      toysCamera.lookAt(0, 0, 0);
      animateToys();
    }

    function clearToys() {
      toyObjects.forEach(obj => toysScene.remove(obj.mesh));
      toyObjects = [];
      document.getElementById('toys-result').innerText = "";
    }

    function createCoinGeometry() {
      const geo = new THREE.CylinderGeometry(1.2, 1.2, 0.15, 32);
      const matSide = new THREE.MeshStandardMaterial({ color: 0xdaa520 });
      const matHead = createCoinMaterial("$"); 
      const matTail = createCoinMaterial("1"); 
      return new THREE.Mesh(geo, [matSide, matHead, matTail]);
    }
    function createCoinMaterial(text) {
      const canvas = document.createElement('canvas');
      canvas.width = 128; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      const grad = ctx.createRadialGradient(64,64,10,64,64,64);
      grad.addColorStop(0, '#ffd700'); grad.addColorStop(1, '#b8860b');
      ctx.fillStyle = grad; ctx.fillRect(0, 0, 128, 128);
      ctx.fillStyle = '#5a4a10'; ctx.font = 'bold 80px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(text, 64, 64);
      ctx.lineWidth = 5; ctx.strokeStyle = '#5a4a10'; ctx.beginPath(); ctx.arc(64,64,55,0,Math.PI*2); ctx.stroke();
      const tex = new THREE.CanvasTexture(canvas);
      return new THREE.MeshStandardMaterial({ map: tex, metalness: 0.8, roughness: 0.3 });
    }
    
    function createDiceGeometry() {
        const geo = new THREE.BoxGeometry(1.5, 1.5, 1.5);
        const m1 = createDiceTexture(1, '#d00'); 
        const m2 = createDiceTexture(2, '#00d'); 
        const m3 = createDiceTexture(3, '#0d0'); 
        const m4 = createDiceTexture(4, '#d0d'); 
        const m5 = createDiceTexture(5, '#dd0'); 
        const m6 = createDiceTexture(6, '#0dd'); 
        const materials = [m3, m4, m1, m6, m2, m5];
        return new THREE.Mesh(geo, materials);
    }
    function createDiceTexture(number, color) {
      const canvas = document.createElement('canvas');
      canvas.width = 128; canvas.height = 128;
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = color; ctx.fillRect(0, 0, 128, 128);
      ctx.strokeStyle = "#fff"; ctx.lineWidth = 10; ctx.strokeRect(0,0,128,128);
      ctx.fillStyle = 'white'; const dotSize = 14;
      const drawDot = (x, y) => { ctx.beginPath(); ctx.arc(x, y, dotSize, 0, Math.PI*2); ctx.fill(); };
      if(number%2!==0) drawDot(64,64);
      if(number>1) { drawDot(30,30); drawDot(98,98); }
      if(number>3) { drawDot(30,98); drawDot(98,30); }
      if(number===6) { drawDot(30,64); drawDot(98,64); }
      const tex = new THREE.CanvasTexture(canvas);
      return new THREE.MeshStandardMaterial({ map: tex });
    }

    function throwObjects(type) {
      clearToys();
      const qty = parseInt(document.getElementById(type + '-qty').value) || 1;
      let results = [];
      
      for(let i=0; i<qty; i++) {
        let mesh, targetRot, res;
        if(type === 'coin') {
          res = Math.random() > 0.5 ? "HEADS" : "TAILS";
          mesh = createCoinGeometry();
          const baseRotX = res === "HEADS" ? 0 : Math.PI;
          targetRot = { x: baseRotX, z: 0 };
        } else {
          const val = Math.floor(Math.random() * 6) + 1; 
          res = val.toString();
          mesh = createDiceGeometry();
          if(val===1) targetRot = {x:0, z:0};
          if(val===6) targetRot = {x:Math.PI, z:0};
          if(val===2) targetRot = {x:-Math.PI/2, z:0};
          if(val===5) targetRot = {x:Math.PI/2, z:0};
          if(val===3) targetRot = {x:0, z:Math.PI/2};
          if(val===4) targetRot = {x:0, z:-Math.PI/2};
        }
        results.push(res);
        mesh.position.set((Math.random()-0.5)*4, 7 + Math.random()*2, (Math.random()-0.5)*2);
        mesh.rotation.set(Math.random()*Math.PI*2, Math.random()*Math.PI*2, Math.random()*Math.PI*2);
        toysScene.add(mesh);
        toyObjects.push({
          mesh: mesh, targetRot: targetRot,
          vel: new THREE.Vector3((Math.random()-0.5)*0.15, 0, (Math.random()-0.5)*0.15),
          rotVel: new THREE.Vector3(Math.random()+0.5, Math.random()+0.5, Math.random()+0.5),
          yVel: 0, yPos: mesh.position.y, settled: false
        });
      }
      document.getElementById('toys-result').innerText = "RESULT: " + results.join(", ");
    }

    function animateToys() {
      toysAnimFrameId = requestAnimationFrame(animateToys);
      toyObjects.forEach(obj => {
        if (obj.settled) {
            obj.mesh.rotation.x += (obj.targetRot.x - obj.mesh.rotation.x) * 0.1;
            obj.mesh.rotation.z += (obj.targetRot.z - obj.mesh.rotation.z) * 0.1;
            return;
        }
        obj.yVel -= 0.02; obj.yPos += obj.yVel;
        if(obj.yPos <= 0.7) {
          obj.yPos = 0.7; obj.yVel *= -0.5; obj.rotVel.multiplyScalar(0.8);
          if(Math.abs(obj.yVel) < 0.05) {
             obj.settled = true;
             const snap = (val, target) => { let cycles = Math.round(val / (Math.PI*2)); return target + cycles * Math.PI * 2; };
             obj.targetRot.x = snap(obj.mesh.rotation.x, obj.targetRot.x);
             obj.targetRot.z = snap(obj.mesh.rotation.z, obj.targetRot.z);
          }
        }
        obj.mesh.position.y = obj.yPos;
        obj.mesh.position.x += obj.vel.x;
        obj.mesh.position.z += obj.vel.z;
        if(!obj.settled) {
            obj.mesh.rotation.x += obj.rotVel.x;
            obj.mesh.rotation.y += obj.rotVel.y;
            obj.mesh.rotation.z += obj.rotVel.z;
        }
      });
      if(toysRenderer && toysScene && toysCamera) toysRenderer.render(toysScene, toysCamera);
    }

    /* ====== 6. Timer Logic ====== */
    let timerInterval; let timeLeft = 1500; let isRunning = false;
    function formatTime(sec) { return `${Math.floor(sec/60).toString().padStart(2,'0')}:${(sec%60).toString().padStart(2,'0')}`; }
    function updateTimerDisplay() { document.getElementById('timer-val').innerText = formatTime(timeLeft); }
    function setTimer(min) { stopTimer(); timeLeft = min * 60; updateInputs(min, 0); updateTimerDisplay(); }
    function setCustomTimer() { stopTimer(); const m = parseInt(document.getElementById('timer-input-min').value)||0; const s = parseInt(document.getElementById('timer-input-sec').value)||0; timeLeft = m*60+s; updateTimerDisplay(); }
    function updateInputs(m, s) { document.getElementById('timer-input-min').value = m; document.getElementById('timer-input-sec').value = s; }
    function toggleTimer() { if(isRunning) stopTimer(); else startTimer(); }
    function startTimer() { isRunning = true; document.getElementById('timer-btn').innerText = "PAUSE"; timerInterval = setInterval(() => { if(timeLeft > 0) { timeLeft--; updateTimerDisplay(); } else { stopTimer(); alert("Time is up!"); } }, 1000); }
    function stopTimer() { isRunning = false; document.getElementById('timer-btn').innerText = "START"; clearInterval(timerInterval); }
    function resetTimer() { stopTimer(); timeLeft = 1500; updateInputs(25, 0); updateTimerDisplay(); }
  </script>
</body>
</html>
